<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Wallet</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.5.0/web3.min.js"></script> <!-- Add Web3.js -->
</head>
<body>
    <div class="container mt-5">
        <h1>Track Ethereum Wallet</h1>
        <form id="track-form">
            <div class="form-group">
                <label for="wallet_address">Wallet Address</label>
                <input type="text" class="form-control" id="wallet_address" placeholder="Enter Ethereum wallet address" required>
            </div>
            <button type="button" class="btn btn-primary" onclick="trackWallet()">Track</button>
        </form>
        <div id="result"></div>
        <h2 class="mt-5">Visualize Transactions</h2>
        <a href="/visualize" class="btn btn-secondary">View Transaction Flow</a>
    </div>

    <script>
        let web3;
        
        // Check if Web3 is injected
        if (typeof window.ethereum !== 'undefined') {
            web3 = new Web3(window.ethereum);
            window.ethereum.request({ method: 'eth_requestAccounts' }) // Request user permission
                .then(() => {
                    console.log('Web3 initialized');
                })
                .catch(error => {
                    console.error('User denied account access:', error);
                    alert('Please allow access to your Ethereum account.');
                });
        } else {
            alert('Please install MetaMask!');
        }

        function trackWallet() {
            const address = document.getElementById('wallet_address').value;

            // Check if Web3 instance and utils are available
            if (web3 && web3.utils && web3.utils.isAddress(address)) {
                web3.eth.getBalance(address)
                    .then(balance => {
                        const balanceEth = web3.utils.fromWei(balance, 'ether');
                        document.getElementById('result').innerText = `Balance of ${address}: ${balanceEth} ETH`;
                    })
                    .catch(error => {
                        document.getElementById('result').innerText = 'Error fetching balance.';
                        console.error(error);
                    });
            } else {
                document.getElementById('result').innerText = 'Invalid Ethereum address or Web3 not initialized!';
            }
        }
    </script>
</body>
</html>
